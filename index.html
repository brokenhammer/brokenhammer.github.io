<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<link rel="stylesheet" href="static/editormd.css" />
<link rel="stylesheet" href="static/editormd.preview.css" />
<link rel="stylesheet" href="static/bootstrap.min.css"/>
<link type="text/css" rel="stylesheet" href="static/katex.min.css">
<div id="app">
    <div v-for="blog in blog_list" class="markdown-body editormd-html-preview">
        <h1>{{blog.title}}</h1>
        <span v-html="blog.html"></span>
    </div>
</div>

<script>
    var app = new Vue({
        el:"#app",
        data:{
            blog_addrs:[],
            blog_html:[]},
        created: function(){
            var vm = this
            var host = "https://ximul.tk/"
            axios.get(host+'api/get_all_blogs')
            .then(function(response){
                vm.blog_addrs = response.data.sort().reverse()
                var promises = [];
                vm.blog_addrs.forEach(element => {
                    promises.push(axios.get(host+'load_blog_html/'+element))
                });
                axios.all(promises).then(function(results){
                    results.forEach(function(blog_html_data){
                        vm.blog_html.push(blog_html_data.data)
                    })
                })
            })            
        },
        computed:{
            blog_list:function(){
                var list = [];
                for (var i=0; i<this.blog_addrs.length; i++){
                    var detail = this.blog_addrs[i].split("/")
                    var date = detail.slice(0, 3).join("-")
                    var title = detail[3]
                    list.push({
                        "title":title,
                        "date": date,
                        "html": this.blog_html[i]})
                }
                return list;
            }
        }
        
    })
</script>
